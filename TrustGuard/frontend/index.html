<!DOCTYPE html>
<html>
<head>
<title>TrustGuard</title>

<style>
    #alertBanner{
margin:15px 0;
padding:15px;
border-radius:12px;
font-size:18px;
font-weight:bold;
text-align:center;
background:#111;
box-shadow:0 0 10px cyan;
}
.safeAlert{color:#00ff9d;}
.warnAlert{color:orange;}
.dangerAlert{color:red;}

    #userStatus{
margin:15px 0;
padding:15px;
border-radius:10px;
font-size:16px;
background:#111;
}
.safeStatus{color:lightgreen;}
.warnStatus{color:orange;}
.dangerStatus{color:red;}

    body{
margin:0;
font-family:Arial;
background:linear-gradient(120deg,#0f2027,#203a43,#2c5364);
color:white;
display:flex;
justify-content:center;
align-items:flex-start;
min-height:100vh;
padding:40px 0;
overflow-y:auto;
}
.container{
background:#000000cc;
padding:40px;
border-radius:15px;
box-shadow:0 0 20px cyan;
width:600px;
text-align:center;
position:relative;
}
textarea{
width:100%;
height:150px;
border-radius:10px;
border:none;
padding:15px;
font-size:16px;
}
button{
margin-top:20px;
padding:15px 40px;
border:none;
border-radius:30px;
background:#00e5ff;
font-size:18px;
cursor:pointer;
transition:0.3s;
}
button:hover{
background:#00bcd4;
transform:scale(1.05);
}
#result{margin-top:20px;font-size:20px;}
.safe{color:lightgreen;}
.medium{color:orange;}
.high{color:red;}
#meter{width:100%;height:25px;background:#333;border-radius:20px;overflow:hidden;margin-top:20px;}
#bar{height:100%;width:0%;background:green;transition:0.5s;}
#advice{margin-top:15px;font-size:16px;padding:15px;border-radius:10px;background:#111;}

/* Modal background */
#overlay{
display:none;
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,0.7);
z-index:5;
}

/* Popup */
.popup{
display:none;
position:fixed;
top:50%;
left:50%;
transform:translate(-50%,-50%);
width:80%;
max-width:500px;
background:#000;
border:2px solid cyan;
border-radius:15px;
padding:20px;
max-height:300px;
overflow-y:auto;
box-shadow:0 0 30px cyan;
z-index:10;
}
.closeBtn{
position:absolute;
top:10px;
right:15px;
cursor:pointer;
color:red;
font-size:22px;
font-weight:bold;
}
</style>

</head>

<body>

<div id="overlay" onclick="hidePopups()"></div>

<div class="container">

<h1>TrustGuard</h1>
<p>AI-Powered Online Safety Checker</p>
    <div id="alertBanner"></div>

<div id="userStatus"></div>

<textarea id="text" placeholder="Paste suspicious message, email or link here..."></textarea>

<button onclick="check()">Analyze</button>

<div id="meter"><div id="bar"></div></div>

<div id="result"></div>
<div id="advice"></div>

<button onclick="showHistory()">View Scan History</button>
<button onclick="showProfile()">View Trust Profile</button>
<button onclick="downloadReport()">Download Report</button>
    <button onclick="clearHistory()">Clear History</button>

</div>

<div id="historyPopup" class="popup">
<span class="closeBtn" onclick="hidePopups()">X</span>
<h3>Scan History</h3>
<div id="historyBox"></div>
</div>

<div id="profilePopup" class="popup">
<span class="closeBtn" onclick="hidePopups()">X</span>
<h3>Your Trust Profile</h3>
<div id="profileBox"></div>
</div>

<script>
    function loadAlert(){
fetch("http://127.0.0.1:5000/status")
.then(r=>r.json())
.then(s=>{
let banner=document.getElementById("alertBanner");

let cls="safeAlert";
let text="No threats detected";

if(s.safety_score < 50){
cls="dangerAlert";
text="You are being targeted";
}
else if(s.safety_score < 80){
cls="warnAlert";
text="Suspicious activity detected";
}

banner.className = cls;
banner.innerText = text;
});
}

    function loadStatus(){
fetch("http://127.0.0.1:5000/status")
.then(r=>r.json())
.then(s=>{
let color="safeStatus";
if(s.safety_score<50) color="dangerStatus";
else if(s.safety_score<80) color="warnStatus";

document.getElementById("userStatus").innerHTML=
"<b>"+s.status+"</b><br>Personal Safety Score: "+s.safety_score+"/100";

document.getElementById("userStatus").className=color;
});
}

function check(){
let text=document.getElementById("text").value;

fetch("http://127.0.0.1:5000/analyze",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({text:text})
})
.then(r=>r.json())
.then(data=>{
let bar=document.getElementById("bar");
bar.style.width=data.trust_score+"%";
bar.style.background=data.trust_score<40?"red":data.trust_score<70?"orange":"green";

let color=data.risk_level=="High Risk"?"high":data.risk_level=="Medium Risk"?"medium":"safe";

document.getElementById("result").innerHTML=
"<h3>Trust Score: "+data.trust_score+"</h3>"+
"<h3 class='"+color+"'>"+data.risk_level+"</h3>"+
"<p>Detected Threats: "+data.flags.join(", ")+"</p>";

document.getElementById("advice").innerHTML=
data.risk_level=="High Risk"?
"Do NOT click links or share info. Block & report.":
data.risk_level=="Medium Risk"?
"Verify before trusting.":
"This message appears safe.";

loadHistory();
loadProfile();
loadStatus();
loadAlert();

});
}

function loadHistory(){
fetch("http://127.0.0.1:5000/history").then(r=>r.json()).then(d=>{
let h="";
for(let i=d.length-1;i>=0;i--){
h+="<p>"+d[i].risk+" ("+d[i].score+"): "+d[i].text+"</p>";
}
document.getElementById("historyBox").innerHTML=h;
});
}

function loadProfile(){
fetch("http://127.0.0.1:5000/profile").then(r=>r.json()).then(p=>{
document.getElementById("profileBox").innerHTML=
"Total scans: "+p.total_scans+"<br>"+
"High risk: "+p.high_risk+"<br>"+
"Medium risk: "+p.medium_risk+"<br>"+
"Safe: "+p.safe;
});
}

function showHistory(){
hidePopups();
document.getElementById("overlay").style.display="block";
document.getElementById("historyPopup").style.display="block";
}

function showProfile(){
hidePopups();
document.getElementById("overlay").style.display="block";
document.getElementById("profilePopup").style.display="block";
}

function hidePopups(){
document.getElementById("overlay").style.display="none";
document.getElementById("historyPopup").style.display="none";
document.getElementById("profilePopup").style.display="none";
}

function downloadReport(){
window.open("http://127.0.0.1:5000/export");
}
    loadAlert();
function clearHistory(){
fetch("http://127.0.0.1:5000/clear",{method:"POST"})
.then(r=>r.json())
.then(()=>{
document.getElementById("historyBox").innerHTML="";
document.getElementById("profileBox").innerHTML="";
loadStatus();
loadAlert();
});
}

</script>

</body>
</html>
